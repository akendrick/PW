<?php

/**
 * @file
 *  General hacks.
 *  - Not in use at this time.
 *  - MOre of a placeholder.
 */

define ('DEBUG', FALSE);

/**
 * Implementation of HOOK_page
 */
function pennywise_init() {
  
  drupal_add_css(drupal_get_path('module', 'pennywise') . '/css/pennywise.css', array('type' => 'file'));

}


/**
 * Implementation of HOOK_menu
 *  - Custom form pages for Adworks, Classified & Display node creation.
 *  - Callback page for ad promotion.
 */
function pennywise_menu() {

//  $items['admin/pennywise/classified/submit-classified'] = array(
//    'title'            => 'Create Classified Ad',
//    'access arguments' => array('Classified Ads: Create new content'),
//    'weight'           => 10,
//    'page callback'    => 'pennywise_create_node_page',
//    'page arguments'   => array('classified'),
//    'type'             => MENU_IS_LOCAL_TASK,
//  );

//  $items['admin/pennywise/classified/adworks-upload'] = array(
//    'title' => 'Upload Adworks File',
//    'page callback'    => 'pennywise_create_node_page',
//    'page arguments'   => array('adworks_file'),
//    'access arguments' => array('Adworks File: Create new content'),
//    'type'             => MENU_IS_LOCAL_TASK,
//    'weight'           => 20,
//  );
//
//  $items['admin/pennywise/display_ads/add'] = array(
//    'title'            => 'Create Display Ad',
//    'access arguments' => array('Display ads: Create new content'),
//    'weight'           => 10,
//    'page callback'    => 'pennywise_create_node_page',
//    'page arguments'   => array('display_ads'),
//    'type'             => MENU_IS_LOCAL_ACTION,
//  );
//
//  $items['admin/pennywise/classified/promote/%'] = array(
//    'title' => 'Promote',
//    'page callback'    => 'promote_to_classified_ad',
//    'page arguments'   => array(3),
//    'access arguments' => array('Adworks File: Create new content'),
//    'file'             => 'promote_classifieds.inc',
/*     'type'             => MENU_CALLBACK, */
//  );
//  return $items;
}

/**
 * Custom page call back
 *
 * @return
 *  Create new display ad.
 **/
function pennywise_create_node_page($node_type) {
  dpm($node_type);
  module_load_include('inc', 'node', 'node.pages');
  $content = node_add($node_type);
  
  return $content;
}

/**
* Custom support function for MENU_LOCAL_TASKS_ALTER
*
* Custom sub-function for filling details into LOCAL ACTIONS
*/
function pennywise_custom_action_links($node_type, $action_link_name, $destination = NULL) {
  $item = menu_get_item('node/add/' . $node_type); 
  $item['title'] = $action_link_name ;
  if ($destination) {
    $item['path'] = $item['path'] . '?destination=' . $destination;
  }
  if ($item['access']) {
    return array(
      '#theme' => 'menu_local_action',
      '#link'  => $item,
    );
  }
}
/**
* Implementation of HOOK_menu_local_tasks_alter
* 
* Create Action Links dependant on URL and access.
*/
function pennywise_menu_local_tasks_alter(&$data, $router_item, $root_path) {

  // Add action links.
  $match = explode('/', $root_path);
  if ($match[0] == 'admin' && $match[1] == 'pennywise') {
    switch ($match[2]) {
      case 'display_ads':
        $data['actions']['output'][] = pennywise_custom_action_links('display-ads', 'Create Display Ad');
        break;
      case 'article':
        $data['actions']['output'][] = pennywise_custom_action_links('article', 'Create Editorial');
        break;
      case 'attachments':
        $data['actions']['output'][] = pennywise_custom_action_links('attachment', 'Create Attachment');
        break;
      case 'page':
        $data['actions']['output'][] = pennywise_custom_action_links('page', 'Create New Page');
        break;
      case 'classified':
        $data['actions']['output'][] = pennywise_custom_action_links('classified', 'Create Classified Ad');
        $data['actions']['output'][] = pennywise_custom_action_links('adworks-file', 'Upload Adworks File');
        break;
      default: 
        $data['actions']['output'][] = pennywise_custom_action_links('display-ads', 'Create Display Ad');
        $data['actions']['output'][] = pennywise_custom_action_links('article', 'Create Editorial');
        $data['actions']['output'][] = pennywise_custom_action_links('classified', 'Create Classified Ad');
        $data['actions']['output'][] = pennywise_custom_action_links('adworks-file', 'Upload Adworks File');
        $data['actions']['output'][] = pennywise_custom_action_links('page', 'Create New Page');
        break;
    }
  }
  elseif ($match[0] == 'node' && $match[1] == 'add') {
    switch ($match[2]) {
      case 'display-ads':
        $data['actions']['output'][] = pennywise_custom_action_links('attachment', 'Add file attachment');
        break;
    }
  }
}
