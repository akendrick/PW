<?php

/**
* @page
*
* Generates receipt from Variable table
*/

/**
* Thank You Page
* - Only present if Temp_id is present - generated by ad_payment_node_insert().
* @return
* - Generated receipt page, or link to ad submission page.
*/
function thankyou_page($temp_id = NULL) {
  if (!$temp_id) {
    $content .= "<div id='adsubmission-thank-you'>";
    $content .= "<h3 class='thank-you thank-you-header'>There are no submitted ads at this time.</h3>";
    $content .= "<p class='thank-you thank-you-body'>";
    $content .= '<p>' . l('Submit new classified ad.', 'ad/submit') . '<p>';
    $content .= '</div>';
  }
  else {
    $data = variable_get('ad_submission_' . $temp_id);
    $data['receipt'] = $temp_id;

    $content = ad_payment_receipt($temp_id, $data);

    // Send Email upon Completion.
    module_load_include('inc', 'ad_payment', 'ad_payment_mail');
    ad_payment_send_email('receipt', $data);


  }

  return $content;
}

/**
* Thank You Page for free ads
*
* @return
* - Default thank you page.
*/
function thankyou_free() {
    $content = '';
    $content .= "<div id='adsubmission-thank-you'>";
    $content .= "<h3 class='thank-you thank-you-header'>Thank you for submitting a free ad.</h3>";
    $content .= "<p class='thank-you thank-you-body'>";
    $content .= '<p>' . l('Submit another free ad.', 'submit-free') . '<p>';
    $content .= '</div>';

  return $content;
}


/**
* Implementation of custom theming function
*
* @vars
* $temp_id - temporary ad receipt id generated to link data from vars table
* $data - array of non-sensitive
* @TODO
*   Replace with THEME function.
*/


function ad_payment_receipt($temp_id, $data = NULL) {
  global $base_url;
  // AD Details
  $details = "
      <div class='receipt-details grid-8 alpha'>
        <h3 class='receipt-details-title'>Ad Details</h3>
      <div class='receipt-details-inner'>
        <dl class='receipt-copy'>
          <dt class='receipt-copy'>Ad: <div class='receipt-copy-word-count'>(" . $data['wordcount'] . " Words)</div></dt>
          <dd class='receipt-copy'>" . $data['ad_copy'] . "</dd>
        </dl>
        <dl class='receipt-area'>
          <dt class='receipt-area'>Publication Area:</dt>
          <dd class='receipt-area'>" . $data['areas'] . "</dd>
        </dl>
        <dl>
          <dt class='receipt-section'>Section:</dt>
          <dd class='receipt-copy'>" . $data['section_name'] . "</dd>
        </dl>
        <dl class='receipt-rate'>
          <dt class='receipt-rate'>Rate:</dt>
          <dd class='receipt-copy'>" . $data['rate']['rate_name'] . "</dd>
        </dl>
        <dl class='receipt-duration'>
          <dt class='receipt-duration'>Duration:</dt>
          <dd class='receipt-copy'>" . $data['duration']['actual'] . " weeks</dd>
        </dl>";

    if ($data['ad_type']) {
      $ad_type = ($data['ad_type'] == FALSE) ? 'Classified ' : 'Liveload Classified ';
      $details .= "
        <dl class='receipt-liveload'>
          <dt class='receipt-liveload'>Ad Type:</dt>
          <dd class='receipt-copy'>" . $ad_type . "</dd>
        </dl>";
    }
    if ($data['image']) {
        $details .= "
          <dl class='receipt-image'>
            <dt class='receipt-image'>Image:</dt>
            <dd class='receipt-copy'>Image received (fid: " . $data['image'] . ")</dd>
          </dl>";
    }
    if ($data['notes']) {
        $details .= "
          <dl class='receipt-notes'>
            <dt class='receipt-notes'>Notes:</dt>
            <dd class='receipt-copy'>" . $data['notes'] . "</dd>
          </dl>";
    }
    $details .= "\t </div></div>";

  $price = "
      <div class='small-receipt receipt-price grid-8 omega'>
        <h4 class='receipt-price-title'>Price</h3>
      <div class='small-receipt small-receipt-inner receipt-price-inner'>
        <dl class='receipt-price-subtotal'>
          <dt class='receipt-price-subtotal'>Sub-total:</dt>
          <dd class='receipt-price-subtotal'>$" . $data['subtotal'] . "</dt>
        </dl>
        <dl class='receipt-price-extras'>
          <dt class='receipt-price-extras'>Extras:</dt>
          <dd class='receipt-price-extras'>$" . $data['extras'] . "</dt>
        </dl>
        <dl class='receipt-price-taxes'>
          <dt class='receipt-price-taxes'>Taxes:</dt>
          <dd class='receipt-price-taxes'>$" . $data['taxes'] . "</dt>
        </dl>
        <dl class='receipt-price-total'>
          <dt class='receipt-price-total'>Total:</dt>
          <dd class='receipt-price-total'>$" . $data['total'] . "</dt>
        </dl>
        <dl class='receipt-contact-card'>
          <dt class='receipt-contact-card'>Payment:</dt>
          <dd class='receipt-contact-card'> " . $data['user']['card-type'] . " </dt>
        </dl>
      </div>
      </div>
    ";

  $contact = "
      <div class='small-receipt receipt-contact grid-8 omega'>
        <h4 class='receipt-contact'>Contact Information</h3>
        <em>An email has been sent to your address with the details.</em>
        <div class='small-receipt small-receipt-inner receipt-contact-inner'>
        <dl class='receipt-contact-name'>
          <dt class='receipt-contact-name'>Name:</dt>
          <dd class='receipt-contact-name'>" . $data['user']['real-name']  . "</dt>
        </dl>
        <dl class='receipt-contact-phone'>
          <dt class='receipt-contact-phone'>Phone:</dt>
          <dd class='receipt-contact-phone'>" . $data['user']['phone'] . "</dt>
        </dl>
        <dl class='receipt-contact-email'>
          <dt class='receipt-contact-email'>Email:</dt>
          <dd class='receipt-contact-email'>" . $data['user']['email'] . "</dt>
        </dl>
     </div>
    </div>
    ";

  // Add PW Logo
  $image_variables = array(
    'path' => 'sites/default/files/pwlogo.gif',
    'title' => 'Pennywise Online Classifieds',
    'attributes' => array('class' => 'pennywise-logo'),
  );

  $content  = "<div id='adsubmission-thank-you'>";
  $content .= "<h3 class='thank-you thank-you-header'>Thank you for choosing Pennywise.</h3>";
  $content .= "<p class='thank-you thank-you-body'>A confirmation message has been sent to your email address.";
  $content .= '<div class="logo">' . theme('image', $image_variables) . '</div>';
  $content .= '<p>Please print this page for your receipt.</p>';
  $content .= '<h3> Ad Confirmation #' . $temp_id . '</h3>';
  $content .= '<div id="ad-submission-receipt" class="ad-receipt-box grid-20 prefix-2 ">' . $details . $price . $contact . '</div>';
  $content .= '<p>' . l('Return to classified ads', '<front>', array('attributes' => array('class' => array('view-classified-ad-link')))) . '<p>';
  $content .= '<p>' . l('Submit another ad', 'ad/submit', array('attributes' => array('class' => array('submit-classified-ad-link')))) . '<p>';
  $content .= '</div>';

   return $content;
}



